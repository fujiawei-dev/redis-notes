---
date: 2022-09-10T17:48:11+08:00  # 创建日期
author: "Rustle Karl"  # 作者

title: "Redis 面试题(02)"  # 文章标题
url:  "posts/redis/interview/answers/q002"  # 设置网页永久链接
tags: [ "redis" ]  # 标签
categories: [ "Redis 学习笔记" ]  # 分类

toc: true  # 目录
draft: true  # 草稿
---

- [Redis 回收进程如何工作的？](#redis-回收进程如何工作的)
- [Redis 如何做大量数据插入？](#redis-如何做大量数据插入)
- [为什么要做 Redis 分区？](#为什么要做-redis-分区)
- [你知道有哪些 Redis 分区实现方案？](#你知道有哪些-redis-分区实现方案)
- [Redis 分区有什么缺点？](#redis-分区有什么缺点)
- [分布式 Redis 是前期做还是后期规模上来了再做好？为什么？](#分布式-redis-是前期做还是后期规模上来了再做好为什么)
- [Twemproxy 是什么？](#twemproxy-是什么)
- [Redis 与其他 key-value 存储有什么不同？](#redis-与其他-key-value-存储有什么不同)
- [Redis 是单线程的，如何提高多核 CPU 的利用率？](#redis-是单线程的如何提高多核-cpu-的利用率)
- [一个 Redis 实例最多能存放多少的 keys ？ List、Set、Sorted Set 他们最多能存放多少元素？](#一个-redis-实例最多能存放多少的-keys--listsetsorted-set-他们最多能存放多少元素)
- [Redis 常见性能问题和解决方案？](#redis-常见性能问题和解决方案)
- [Redis 提供了哪几种持久化方式？](#redis-提供了哪几种持久化方式)
- [如何选择合适的持久化方式？](#如何选择合适的持久化方式)
- [修改配置不重启 Redis 会实时生效吗？](#修改配置不重启-redis-会实时生效吗)

## Redis 回收进程如何工作的？

Redi 检查内存使用情况，如果大于 maxmemory 的限制, 则根据设定好的策略进行回收。

## Redis 如何做大量数据插入？

管道。

## 为什么要做 Redis 分区？

分区可以让 Redis 管理更大的内存，Redis 将可以使用所有机器的内存。

如果没有分区，最多只能使用一台机器的内存。

分区使 Redis 的计算能力通过简单地增加计算机得到成倍提升，Redis 的网络带宽也会随着计算机和网卡的增加而成倍增长。

## 你知道有哪些 Redis 分区实现方案？

**客户端分区**

在客户端就已经决定数据会被存储到哪个 redis 节点或者从哪个 redis 节点读取。大多数客户端已经实现了客户端分区。


**代理分区**

客户端将请求发送给代理，然后代理决定去哪个节点写数据或者读数据。代理根据分区规则决定请求哪些 Redis 实例，然后根据 Redis 的响应结果返回给客户端。

**查询路由**

客户端随机地请求任意一个 redis 实例，然后由 Redis 将请求转发给正确的 Redis 节点。

Redis Cluster 实现了一种混合形式的查询路由，但并不是直接将请求从一个 redis 节点转发到另一个 redis 节点，而是在客户端的帮助下直接 redirected 到正确的 redis 节点。

## Redis 分区有什么缺点？

涉及多个 key 的操作通常不会被支持。例如不能对两个集合求交集。

同时操作多个 key，则不能使用 Redis 事务。

分区使用的粒度是 key，不能使用一个非常长的排序 key 存储一个数据集。

当使用分区的时候，数据处理会非常复杂，例如为了备份必须从不同的 Redis 实例和主机同时收集 RDB / AOF 文件。

分区时动态扩容或缩容可能非常复杂。Redis 集群在运行时增加或者删除 Redis 节点，能做到最大程度对用户透明地数据再平衡，但其他一些客户端分区或者代理分区方法则不支持这种特性。然而，有一种预分片的技术也可以较好的解决这个问题。

## 分布式 Redis 是前期做还是后期规模上来了再做好？为什么？

既然 Redis 是如此的轻量（单实例只使用 1M 内存）, 为防止以后的扩容，最好的办法就是一开始就启动较多实例。即便你只有一台服务器，你也可以一开始就让 Redis 以分布式的方式运行，使用分区，在同一台服务器上启动多个实例。

一开始就多设置几个 Redis 实例，例如 32 或者 64 个实例，对大多数用户来说这操作起来可能比较麻烦，但是从长久来看做这点牺牲是值得的。

这样的话，当你的数据不断增长，需要更多的 Redis 服务器时，你需要做的就是仅仅将 Redis 实例从一台服务迁移到另外一台服务器而已（而不用考虑重新分区的问题）。一旦你添加了另一台服务器，你需要将你一半的 Redis 实例从第一台机器迁移到第二台机器。

## Twemproxy 是什么？

Twemproxy 是 Twitter 维护的（缓存）代理系统，代理 Memcached 的 ASCII 协议和 Redis 协议。它是单线程程序，使用 c 语言编写，运行起来非常快。它是采用 Apache 2.0 license 的开源软件。

Twemproxy 支持自动分区，如果其代理的其中一个 Redis 节点不可用时，会自动将该节点排除（这将改变原来的 keys-instances 的映射关系，所以你应该仅在把 Redis 当缓存时使用 Twemproxy)。

Twemproxy 本身不存在单点问题，因为你可以启动多个 Twemproxy 实例，然后让你的客户端去连接任意一个 Twemproxy 实例。

Twemproxy 是 Redis 客户端和服务器端的一个中间层，由它来处理分区功能应该不算复杂，并且应该算比较可靠的。

## Redis 与其他 key-value 存储有什么不同？

Redis 有着更为复杂的数据结构并且提供对他们的原子性操作，这是一个不同于其他数据库的进化路径。

Redis 的数据类型都是基于基本数据结构的同时对程序员透明，无需进行额外的抽象。

Redis 运行在内存中但是可以持久化到磁盘，所以在对不同数据集进行高速读写时需要权衡内存，应为数据量不能大于硬件内存。

在内存数据库方面的另一个优点是，相比在磁盘上相同的复杂的数据结构，在内存中操作起来非常简单，这样 Redis 可以做很多内部复杂性很强的事情。

同时，在磁盘格式方面是紧凑的以追加的方式产生的，因为并不需要进行随机访问。

## Redis 是单线程的，如何提高多核 CPU 的利用率？

可以在同一个服务器部署多个 Redis 的实例，并把他们当作不同的服务器来使用，在某些时候，无论如何一个服务器是不够的，

所以，如果你想使用多个 CPU，你可以考虑一下分片（shard）。

## 一个 Redis 实例最多能存放多少的 keys ？ List、Set、Sorted Set 他们最多能存放多少元素？

取决于可用内存。

## Redis 常见性能问题和解决方案？

(1) Master 最好不要做任何持久化工作，如 RDB 内存快照和 AOF 日志文件

(2) 如果数据比较重要，某个 Slave 开启 AOF 备份数据，策略设置为每秒同步一次

(3) 为了主从复制的速度和连接的稳定性，Master 和 Slave 最好在同一个局域网内

(4) 尽量避免在压力很大的主库上增加从库

(5) 主从复制不要用图状结构，用单向链表结构更为稳定，即：Master <- Slave1 <- Slave2 <- Slave3...

这样的结构方便解决单点故障问题，实现 Slave 对 Master 的替换。如果 Master 挂了，可以立刻启用 Slave1 做 Master，其他不变。

## Redis 提供了哪几种持久化方式？

![](../../docs/internal/rdb.md)

## 如何选择合适的持久化方式？

应该同时使用两种持久化功能。

## 修改配置不重启 Redis 会实时生效吗？

针对运行实例，有许多配置选项可以通过 `CONFIG SET` 命令进行修改，而无需执行任何形式的重启。

但偶尔重新启动是必须的，如为升级 Redis 程序到新的版本，或者当你需要修改某些目前 CONFIG 命令还不支持的配置参数的时候。
